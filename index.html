<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Online Chat</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        #messages {
            height: 70vh;
            overflow-y: auto;
            padding: 20px;
        }
        .message-card {
            margin-bottom: 15px;
            max-width: 80%;
            word-break: break-word;
        }
        .timestamp {
            font-size: 0.8em;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- GiriÅŸ EkranÄ± -->
        <div id="loginScreen" class="box" style="margin-top: 50px; max-width: 400px;">
            <h1 class="title">Chat OdasÄ±na GiriÅŸ</h1>
            <div class="field">
                <input id="username" class="input" type="text" placeholder="KullanÄ±cÄ± AdÄ±">
            </div>
            <button onclick="login()" class="button is-primary">GiriÅŸ Yap</button>
        </div>

        <!-- Chat EkranÄ± -->
        <div id="chatScreen" style="display: none;">
            <nav class="navbar is-primary">
                <div class="navbar-brand">
                    <div class="navbar-item">
                        <h1 class="title has-text-white">Online Chat</h1>
                    </div>
                </div>
            </nav>

            <div id="messages"></div>

            <div class="field has-addons" style="padding: 20px;">
                <div class="control is-expanded">
                    <input id="messageInput" class="input" type="text" placeholder="MesajÄ±nÄ±z...">
                </div>
                <div class="control">
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <button onclick="document.getElementById('fileInput').click()" class="button is-info">
                        ðŸ“·
                    </button>
                </div>
                <div class="control">
                    <button onclick="sendMessage()" class="button is-success">GÃ¶nder</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase ve UI -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <script>
        // Firebase konfigÃ¼rasyonu
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebase baÅŸlatma
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        let currentUser = null;

        // GiriÅŸ iÅŸlemi
        function login() {
            const username = document.getElementById('username').value.trim();
            if(username) {
                currentUser = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('chatScreen').style.display = 'block';
                loadMessages();
            }
        }

        // Mesaj gÃ¶nderme
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if(message) {
                const newMessage = {
                    text: message,
                    user: currentUser,
                    timestamp: Date.now()
                };
                
                database.ref('messages').push(newMessage);
                messageInput.value = '';
            }
        }

        // Dosya yÃ¼kleme
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if(file) {
                const storageRef = storage.ref(`images/${file.name}`);
                storageRef.put(file).then((snapshot) => {
                    snapshot.ref.getDownloadURL().then((url) => {
                        const newMessage = {
                            image: url,
                            user: currentUser,
                            timestamp: Date.now()
                        };
                        database.ref('messages').push(newMessage);
                    });
                });
            }
        });

        // MesajlarÄ± dinleme
        function loadMessages() {
            database.ref('messages').on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });
        }

        // MesajlarÄ± gÃ¶sterme
        function displayMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-card';

            let content = '';
            if(message.text) {
                content = `
                    <div class="box">
                        <strong>${message.user}</strong>
                        <span class="timestamp">${new Date(message.timestamp).toLocaleString()}</span>
                        <p>${message.text}</p>
                    </div>
                `;
            } else if(message.image) {
                content = `
                    <div class="box">
                        <strong>${message.user}</strong>
                        <span class="timestamp">${new Date(message.timestamp).toLocaleString()}</span>
                        <img src="${message.image}" style="max-width: 300px; margin-top: 10px;">
                    </div>
                `;
            }

            messageDiv.innerHTML = content;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>
